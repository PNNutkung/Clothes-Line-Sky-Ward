<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf8">
        <title>Cloth Line Sky Ward</title>
        <link rel="stylesheet" href="bootstrap-3.3.5-dist/css/bootstrap.min.css">
    </head>
    <body>
        <!-- NOTE: head-page -->
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <h1>Cloth Line Sky Ward</h1>
                </div>
            </div>
        </div>
        <!-- NOTE: front-page -->
        <div class="container" id="front-page">
            <div class="row">
               <div class="col-md-2">
                   <h4>ID : </h4>
               </div>
                <div class="col-md-3">
                    <!-- NOTE: user-input -->
                    <input type="text" class="form-control" id="user-input" placeholder="input your ID">
                </div>
            </div>
            <div class="row">
                <div class="col-md-2">
                    <h4>Password :</h4>
                </div>
                <div class="col-md-3">
                    <!-- NOTE: pass-input -->
                    <input type="password" class="form-control" id="pass-input" placeholder="input your password">
                </div>
            </div>
            <div class="row">
                <div class="col-md-2">
                    <!-- NOTE: register-btn -->
                    <button type="button" class="btn btn-warning btn-lg" id="register-btn">Register</button>
                </div>
                <div class="col-md-2">
                    <!-- NOTE: login-btn -->
                    <button type="button" class="btn btn-success btn-lg" id="login-btn">Login</button>
                </div>
            </div>
        </div>
        <!-- NOTE: main-page -->
        <div class="container" id="main-page">
            <div class="row">
               <!-- NOTE: humidity label -->
                <div class="col-md-6">
                    <div class="carousel slide" data-ride="carousel">
                        <div class="carousel-inner">
                            <div class="item active">
                               <!-- TODO: Find new picture -->
                                <img src="images/FPODV45HUEENATH.LARGE.jpg" alt="" class="img-responsive" id="humidity-img">
                               <div class="carousel-caption" id="humidity">
                                       Humidity: 0
                               </div>
                            </div>
                          </div>
                    </div> 
                </div>
                <!-- NOTE: rain status -->
                <div class="col-md-6">
                    <div class="carousel slide" data-ride="carousel">
                        <div class="carousel-inner">
                            <div class="item active">
                               <!-- TODO: Find new picture -->
                                <img src="images/FPODV45HUEENATH.LARGE.jpg" alt="" class="img-responsive" id="rain-img">
                               <div class="carousel-caption" id="rain">
                                       Dry
                               </div>
                            </div>
                          </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <!-- NOTE: galileo status -->
                <div class="col-md-3">
                    <div class="well well-md" id="state">Outdoor</div>
                </div>
            </div>
            <div class="row">
                <!-- NOTE: state-btn -->
                <div class="col-md-12">
                    <button class="btn btn-success btn-lg" id="state-btn">Pull Back</button>
                </div>
            </div>
            <div class="row">
                <!-- NOTE: logout-btn -->
                <div class="col-md-12">
                    <button type="button" class="btn btn-danger btn-lg" id="logout-btn">Logout</button>
                </div>
            </div>
        </div>
        <script src="jquery-2.1.4.min.js"></script>
        <script>
            //NOTE: Page Variable
            var front_page = $("#front-page")
            var main_page = $("#main-page")
            
            //NOTE: Local Element Variable
            var user;
            var pass;
            var num_current;
            
            //NOTE: Server Element Variable
            //TODO uncomment two variable when connect to real server
            //var user-sv;
            //var pass-sv;
            var num_account;
            var humidity;
            var isRain;
            var state;
            
            //NOTE: Boolean Variable
            var isLogin = false;
            
            //NOTE: Hide unused page
            main_page.hide();
            
            //NOTE: Boolean Function
            //NOTE: Check ID and pass
            function checkAccount(){
                user = $("#user-input").val()
                pass = $("#pass-input").val()
                $.get("http://exceed.cupco.de/iot/SeatBelt/clsw-num",onLoadedNumUser);
                for (var i=1;i<=num_account;i++) { //NOTE: Loop for checking more than one user from server
                    $.get("http://exceed.cupco.de/iot/SeatBelt/clsw-user"+i,onLoadedUser);
                    $.get("http://exceed.cupco.de/iot/SeatBelt/clsw-pass"+i,onLoadedPassword);
                    num_current = i;
                    if(user===user_sv&&pass===pass_sv) return true
                }
                return false
            }
            
            //NOTE: Switching function
            //NOTE: Switch to Main Page
            function goToMainPage(){
                //TODO uncomment every line when connect to server
                //if (checkAccount()) {
                    front_page.fadeOut()
                    main_page.fadeIn()
                    isLogin = true;
               // }
               // else{
                    //TODO write alert red box when failed to login
                //}
            }
            //NOTE: Switch to Front Page
            function goToFrontPage(){
                isLogin = false
                main_page.fadeOut();
                front_page.fadeIn();
            }
            
            //NOTE: refresh to update state
            function refresh(){
                $.get("http://exceed.cupco.de/iot/SeatBelt/clsw-humidity"+num_current,onLoadedHumidity);
                $.get("http://exceed.cupco.de/iot/SeatBelt/clsw-raining"+num_current,onLoadedRainingStatus);
                $.get("http://exceed.cupco.de/iot/SeatBelt/clsw-state"+num_current,onLoadedState);
                updateGUI();
            }
            
            //NOTE: Action Function
            //NOTE: Update GUI
            function updateGUI(){
                $("#state").text(state);
                if (isRain) {
                    $("#rain").text("Rainning")
                    //TODO search and set image to this part.
                    //NOTE: $("rain-img").attr("src",URLIMage")
                }
                else {
                    $("#rain").text("Dry")
                    //TODO search and set image to this part.
                }
                $("#humidity").text(humidity)
                //TODO search and set image to this part.
                $("state").text(state);
                
            }
            function postState(){
                //TODO update state and state-btn
                $.post("http://exceed.cupco.de/iot/SeatBelt/clws-state"+num_current,{data:state});
            }
            
            //NOTE: Group of resource loader function
            //NOTE: Load number of user
            function onLoadedNumUser(result){
                num_account=result
            }
            //NOTE: Load user id
            function onLoadedUser(result){
                user_sv = result
            }
            //NOTE: Load password
            function onLoadedPassword(result){
                pass_sv = result
            }   
            //NOTE: Load Humidity value
            function onLoadedHumidity(result){
                humidity = result
            }
            //NOTE: Load Raining status
            function onLoadedRainingStatus(result){
                if (result===0) isRain=false
                else isRain=true
            }
            //NOTE: Load State
            function onLoadedState(result){
                state = result
            }
            //Button ActionListener
            $("#login-btn").click(goToMainPage)
            $("#logout-btn").click(goToFrontPage)
        </script>
    </body>
</html>