<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf8">
        <title>Clothes line Sky Ward</title>
        <link rel="stylesheet" href="bootstrap-3.3.5-dist/css/bootstrap.min.css">
        <link rel="stylesheet" href="bootstrap-material-design/dist/css/material.min.css">
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <!-- NOTE: head-page -->
        <div class="container ">
           <div class="jumbotron header">
            <div class="row">
                <div class="col-md-12">
                    <h1>Cloth Line Sky Ward</h1>
                </div>
            </div>
            </div>
        </div>
        <!-- NOTE: front-page -->
        <div class="container" id="front-page">
           <div class="jumbotron">
            <div class="row rowID">
               <div class="col-md-2 IDtext">
                   <h4>ID</h4>
               </div>
                <div class="col-md-8 inputText">
                    <!-- NOTE: user-input -->
                    <input type="text" class="form-control" id="user-input" placeholder="input your ID" style="font-size:20px">
                </div>
            </div>
            <div class="row rowID">
                <div class="col-md-2 IDtext">
                    <h4>Password</h4>
                </div>
                <div class="col-md-8 inputText">
                    <!-- NOTE: pass-input -->
                    <input type="password" class="form-control" id="pass-input" placeholder="input your password" style="font-size:20px">
                </div>
            </div>
            <div class="row text-center">
                <div class="col-md-4">
                    <!-- NOTE: register-btn -->
                    <a type="button" class="btn btn-primary" id="register-btn" style="font-size:20px" href="regis.html">Register</a>
                </div>
                <div class="col-md-1">
                    <!-- NOTE: login-btn -->
                    <button type="button" class="btn btn-success btn-raised" id="login-btn" style="font-size:20px">Login</button>
                </div>
            </div>
            </div>
        </div>
        <!-- NOTE: main-page -->
        <div class="container" id="main-page">
            <div class="row">
               <!-- NOTE: humidity label -->
               
                <div class="col-md-6">
                   <div class="jumbotron">
                    <div class="carousel slide" data-ride="carousel">
                        <div class="carousel-inner">
                            <div class="item active">
                               <!-- TODO: Find new picture -->
                                <img src="images/humidity2.png" alt="" class="img-responsive" id="humidity-img">
                               <div class="text-center" id="humidity">
                                       Humidity: 0
                               </div>
                            </div>
                          </div>
                    </div> 
                </div>
                </div>
                <!-- NOTE: rain status -->
                <div class="col-md-6">
                   <div class="jumbotron">
                    <div class="carousel slide" data-ride="carousel">
                        <div class="carousel-inner">
                            <div class="item active">
                               <!-- TODO: Find new picture -->
                                <img src="images/rain.png" alt="" class="img-responsive" id="rain-img">
                               <div class="text-center" id="rain">
                                       Rain
                               </div>
                            </div>
                          </div>
                    </div>
                </div>
                </div>
            </div>
            <div class="row">
                <!-- NOTE: galileo status -->
                <div class="col-md-3">
                    <div class="well well-md" id="state">Outdoor</div>
                </div>
            </div>
            <div class="row">
                <!-- NOTE: state-btn -->
                <div class="col-md-12">
                    <button class="btn btn-success btn-lg" id="state-btn">Pull Back</button>
                </div>
            </div>
            <div class="row">
                <!-- NOTE: logout-btn -->
                <div class="col-md-12">
                    <button type="button" class="btn btn-danger btn-lg" id="logout-btn">Logout</button>
                </div>
            </div>
        </div>
        <script src="jquery-2.1.4.min.js"></script>
        <script>
            //NOTE: Hide unused page
            $("#main-page").hide();
        </script>
        <!-- NOTE: Jumbotron -->
        
        <script src="//code.jquery.com/jquery-1.10.2.min.js"></script>
        <script>
            //NOTE: Server Element Variable
            var user_list;
            var pass_list;
            var humidity_list;
            var isRain_list;
            var state_list;
            var handle_list;
            
            //NOTE: Group of resource loader function
            //NOTE: Load list of id
            function onLoadedUserList(result){
                user_list = result.split(",")
            }
            //NOTE: Load password list
            function onLoadedPasswordList(result){
                pass_list = result.split(",")
            }   
            //NOTE: Load Humidity value list
            function onLoadedHumidityList(result){
                humidity = result.split(",")
            }
            //NOTE: Load Raining status list
            function onLoadedRainingStatus(result){
                var listofRain = result.split(",")
                for (var i in listofRain){
                    if (i===0){
                        isRain_list.push(false)
                    }
                    else {
                        isRain_list.push(true)
                    }
                }
            }
            //NOTE: Load State
            function onLoadedState(result){
                for (i in result.split(",")) {
                    if (i===0) {
                        state_list.push("Keep")
                    }
                    else {
                        state_list.push("Extend")
                    }
                }
            }
            //NOTE: Load handle type list
            function onLoadedHandleList(result){
                for (i in result.split(",")) {
                    if (i===0) {
                        handle_list.push(false)
                    }
                    else {
                        handle_list.push(true)
                    }
                }
            }
            
                
            //NOTE: Load every reaource
            function loadResource(){
                $.get("http://exceed.cupco.de/iot/SeatBelt/clsw-user-list",onLoadedUserList);
                $.get("http://exceed.cupco.de/iot/SeatBelt/clsw-pass-list",onLoadedPasswordList);
                $.get("http://exceed.cupco.de/iot/SeatBelt/clsw-humid-list",onLoadedHumidityList);
                $.get("http://exceed.cupco.de/iot/SeatBelt/clsw-rain-list",onLoadedRainingStatus);
                $.get("http://exceed.cupco.de/iot/SeatBelt/clsw-state-list",onLoadedState);
                $.get("http://exceed.cupco.de/iot/SeatBelt/clsw-handle-list",onLoadedHandleList);
            }
            loadResource();
        </script>
        <script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
        <script src="js/ripples.min.js"></script>
        <script src="js/material.min.js"></script>
        <script>
            $(document).ready(function() {
                // This command is used to initialize some elements and make them work properly
                $.material.init();
            });
        </script>
        <script>
            //NOTE: Page Variable
            var front_page = $("#front-page")
            var main_page = $("#main-page")
            
            //NOTE: Local Element Variable
            var user;
            var pass;
            var num_current;
            
            //NOTE: Boolean Variable
            var isLogin = false;
            
            //NOTE: Boolean Function
            //NOTE: Check ID and pass
            function checkAccount(){
                user = $("#user-input").val()
                pass = $("#pass-input").val()
                for (var i =0;i<user_list.length;i++) {
                    if (user===user_list[i]&&pass===pass_list[i]) {
                        num_current = i;
                        return true;
                    }
                }
                num_current = -1;
                return false
            }
            
            //NOTE: Switching function
            //NOTE: Switch to Main Page
            function goToMainPage(){
                if (checkAccount()) {
                    front_page.fadeOut()
                    main_page.fadeIn()
                    isLogin = true;
               }
               else{
                    //TODO write alert red box when failed to login
                }
            }
            //NOTE: Switch to Front Page
            function goToFrontPage(){
                isLogin = false
                main_page.fadeOut();
                front_page.fadeIn();
            }
            
            //NOTE: refresh to update state
            function refresh(){
                loadResource();
                if (isLogin) {
                    updateGUI();
                }
            }
            
            //NOTE: Action Function
            //NOTE: Update GUI
            function updateGUI(){
                $("#state").text(state);
                if (isRain_list[num_current]) {
                    $("#rain").text("Rainning")
                    //TODO search and set image to this part.
                    //NOTE: $("rain-img").attr("src",URLIMage")
                }
                else {
                    $("#rain").text("Dry")
                    //TODO search and set image to this part.
                }
                $("#humidity").text(humidity)
                //TODO search and set image to this part.
                $("state").text(state);
                //TODO make button disable
            }
            //NOTE: Change button color and text when change state and post data to server
            function postState(){
                //TODO update state and state-btn
                //http://api.jquery.com/toggleclass/ เผื่อใช้เปลี่ยนสีได้
                if (state_list[num_current]==="Keep") {
                    state_list[num_current]="Extend"
                }
                else {
                    state_list[num_current]="Keep"
                }
                handle_list[num_current]=false
                $.post("http://exceed.cupco.de/iot/SeatBelt/clws-state-list",{data:state_list.join(",")});
                $.post("http://exceed.cupco.de/iot/SeatBelt/clws-handle-list",{data:handle_list.join(",")});
            }
            
            //Button ActionListener
            $("#login-btn").click(goToMainPage)
            $("#logout-btn").click(goToFrontPage)
            
        </script>
    </body>
</html>